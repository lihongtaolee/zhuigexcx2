(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bbs/detail/detail"],{"18f7":function(t,i,e){"use strict";e.r(i);var o=e("28aa"),n=e("732c");for(var c in n)["default"].indexOf(c)<0&&function(t){e.d(i,t,(function(){return n[t]}))}(c);e("9889");var a=e("828b"),s=Object(a["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);i["default"]=s.exports},2282:function(t,i,e){},"28aa":function(t,i,e){"use strict";e.d(i,"b",(function(){return n})),e.d(i,"c",(function(){return c})),e.d(i,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(e.bind(null,"ef62"))},mpHtml:function(){return Promise.all([e.e("common/vendor"),e.e("components/mp-html/mp-html")]).then(e.bind(null,"8edf"))},uniBadge:function(){return e.e("uni_modules/uni-badge/components/uni-badge/uni-badge").then(e.bind(null,"f42c"))},lPainter:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/lime-painter/components/l-painter/l-painter")]).then(e.bind(null,"cab4"))},uniPopup:function(){return e.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(e.bind(null,"4add"))}},n=function(){var t=this,i=t.$createElement,e=(t._self._c,t.topic&&t.topic.images&&t.topic.images.length>0),o=t.topic&&t.topic.video?parseInt(t.topic.video.width):null,n=t.topic&&t.topic.video?parseInt(t.topic.video.height):null,c=!t.topic||!t.topic.video||o>n?null:parseInt(t.topic.video.width),a=!t.topic||!t.topic.video||o>n?null:parseInt(t.topic.video.height),s=t.topic&&t.topic.video?parseInt(t.topic.video.width):null,r=t.topic&&t.topic.video?parseInt(t.topic.video.height):null,l=!t.topic||!t.topic.video||s<r?null:parseInt(t.topic.video.height),p=!t.topic||!t.topic.video||s<r?null:parseInt(t.topic.video.width),u=t.topic?t.topic.at_users&&t.topic.at_users.length>0:null,d=t.topic?t.topic.subjects&&t.topic.subjects.length>0:null,h=t.topic?t.topic.like_list&&t.topic.like_list.length>0:null,f=t.topic&&h?t.topic.like_list.length:null,m=t.topic&&t.topic.comments.length>0,g=t.topic&&t.topic.recs&&t.topic.recs.length>0,_=t.topic?t.topic.comment_count.toString():null,v=t.topic?t.topic.like_list.length.toString():null,x=t.topic?t.topic.favorites.toString():null,b=t.comment_content.length;t.$mp.data=Object.assign({},{$root:{g0:e,m0:o,m1:n,m2:c,m3:a,m4:s,m5:r,m6:l,m7:p,g1:u,g2:d,g3:h,g4:f,g5:m,g6:g,g7:_,g8:v,g9:x,g10:b}})},c=[]},"732c":function(t,i,e){"use strict";e.r(i);var o=e("a01e"),n=e.n(o);for(var c in o)["default"].indexOf(c)<0&&function(t){e.d(i,t,(function(){return o[t]}))}(c);i["default"]=n.a},9889:function(t,i,e){"use strict";var o=e("2282"),n=e.n(o);n.a},a01e:function(t,i,e){"use strict";(function(t,o){var n=e("47a9");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var c=n(e("7aea")),a=n(e("21c8")),s=n(e("f005")),r=n(e("b2e8")),l={components:{ZhuigeTopic:function(){e.e("components/zhuige-topic").then(function(){return resolve(e("1393"))}.bind(null,e)).catch(e.oe)},ZhuigeReply:function(){e.e("components/zhuige-reply").then(function(){return resolve(e("a634"))}.bind(null,e)).catch(e.oe)},ZhuigeSwiper:function(){e.e("components/zhuige-swiper").then(function(){return resolve(e("2797"))}.bind(null,e)).catch(e.oe)},ZhuigeScrollAd:function(){e.e("components/zhuige-scroll-ad").then(function(){return resolve(e("dc06"))}.bind(null,e)).catch(e.oe)}},data:function(){return this.topic_id=void 0,this.acode=void 0,this.comment_id=0,this.reply_user_id=0,this.traffic_chp=null,this.loginReload=!1,{curImage:100,topic:void 0,isShowPainter:!1,painterImage:"",poster:void 0,base:void 0,comment_content:"",comment_bottom:0,is_report:!1,traffic_ad:void 0}},computed:{slideHeight:function(){if(this.topic&&this.topic.images&&this.topic.images.length>0){var t=this.topic.images[this.curImage],i=750*t.image.height/t.image.width;return"".concat(i,"rpx")}return"".concat(this.curImage,"rpx")}},onLoad:function(i){i.id&&(i.topic_id=i.id),i.topic_id?this.topic_id=i.topic_id:i.scene?this.topic_id=i.scene:this.topic_id=1,this.topic_id?(c.default.addShareScore(i.source),t.$on("linktap",this.onMPHtmlLink),t.$on("zhuige_event_user_like",this.onUserLike),t.$on("zhuige_event_user_login",this.onSetReload)):t.reLaunch({url:"/pages/tabs/index/index"})},onUnload:function(){t.$off("zhuige_event_user_login",this.onSetReload),t.$off("zhuige_event_user_like",this.onUserLike),t.$off("linktap",this.onMPHtmlLink)},onShow:function(){this.topic||this.loadData(),this.loginReload&&(this.loginReload=!1,this.loadData())},onBackPress:function(){return!!this.$refs.popup.isShow&&(this.$refs.popup.close(),!0)},onPullDownRefresh:function(){this.loadData()},onShareAppMessage:function(){return{title:this.contentText()+"-"+getApp().globalData.appName,path:c.default.addShareSource("pages/bbs/detail/detail?topic_id="+this.topic_id)}},onShareTimeline:function(){return{title:this.contentText()+"-"+getApp().globalData.appName}},methods:{onMPHtmlLink:function(t){t["data-link"]&&c.default.openLink(t["data-link"])},onUserLike:function(t){this.topic&&this.topic.recs&&this.topic.recs.length>0&&this.topic.recs.forEach((function(i){i.id==t.post_id&&(i.like_count=t.like_count)}))},onSetReload:function(t){this.loginReload=!0},openLink:function(t){c.default.openLink(t)},onImageChange:function(t){this.curImage=t.detail.current},clickTopicImages:function(i,e){var o=[];i.forEach((function(t){o.push(t.image.url)})),t.previewImage({current:e,urls:o})},clickFollowAuthor:function(){var i=this;r.default.post(s.default.URL("user","follow_user"),{user_id:this.topic.author.user_id}).then((function(e){0==e.code?(i.topic.author.is_follow=e.data.is_follow,t.$emit("zhuige_event_follow_user",{user_id:i.topic.author.user_id,is_follow:e.data.is_follow})):a.default.toast(e.message)}),(function(t){console.log(t)}))},clickLocation:function(){t.openLocation({name:this.topic.location.marker,address:this.topic.location.address,latitude:parseFloat(this.topic.location.latitude),longitude:parseFloat(this.topic.location.longitude),success:function(){}})},clickJoinForum:function(i){var e=this;r.default.post(s.default.URL("user","follow_forum"),{forum_id:i}).then((function(o){e.topic.forum.is_follow=o.data.is_follow,e.topic.forum.user_count=o.data.user_count,t.$emit("zhuige_event_user_join_forum",{forum_id:i,user_count:o.data.user_count})}),(function(t){console.log(t)}))},clickExchange:function(){var i=this;t.showModal({title:"提示",content:"确认使用"+this.topic.score+"积分阅读",success:function(t){t.confirm&&r.default.post(s.default.URL("topic_score","exchange"),{post_id:i.topic_id}).then((function(t){0==t.code?i.loadData():a.default.toast(t.message)}),(function(t){console.log(t)}))}})},clickReward:function(){t.previewImage({current:0,urls:[this.topic.author.reward]})},clickAllComments:function(){c.default.openLink("/pages/base/comments/comments?post_id="+this.topic_id)},checkComment:function(){return this.topic.comment_switch?this.topic.comment_require_mobile2?(c.default.openLink("/pages/user/login/login?type=mobile&tip=评论"),!1):!this.topic.comment_require_avatar2||(c.default.openLink("/pages/user/verify/verify?tip=评论"),!1):(a.default.error("评论已关闭"),!1)},clickComment:function(t){this.checkComment()&&(this.comment_id=t,this.reply_user_id=0,this.$refs.popup.open("bottom"))},clickReply:function(t){this.checkComment()&&(this.comment_id=t.comment_id,this.reply_user_id=t.user_id,this.$refs.popup.open("bottom"))},focusCommentTextarea:function(t){this.comment_bottom=220},blurCommentTextarea:function(t){this.comment_bottom=0},clickSubmitComment:function(){var t=this;0!=this.comment_content.length?r.default.post(s.default.URL("comment","add"),{post_id:this.topic_id,parent_id:this.comment_id,reply_id:this.reply_user_id,content:this.comment_content}).then((function(i){0==i.code?(a.default.toast("审核后，他人可见"),t.comment_id=0,t.reply_user_id=0,t.comment_content="",t.topic.is_comment=1,t.$refs.popup.close()):"require_mobile"==i.code?c.default.openLink("/pages/user/login/login?type=mobile&tip=评论"):"require_avatar"==i.code?c.default.openLink("/pages/user/verify/verify?tip=评论"):a.default.toast(i.message)}),(function(t){console.log(t)})):a.default.toast("请输入评论内容")},clickLike:function(){var i=this;r.default.post(s.default.URL("user","like"),{post_id:this.topic_id}).then((function(e){if(i.topic.is_like=e.data.is_like,e.data.is_like)i.topic.like_list.unshift(e.data.user);else{var o=[];i.topic.like_list.forEach((function(t){t.user_id!=e.data.user.user_id&&o.push(t)})),i.topic.like_list=o}t.$emit("zhuige_event_user_like",{post_id:i.topic_id,like_count:e.data.like_count})}),(function(t){console.log(t)}))},clickFavorite:function(){var t=this;r.default.post(s.default.URL("user","favorite"),{post_id:this.topic_id}).then((function(i){t.topic.is_favorite=i.data.is_favorite,t.topic.favorites=i.data.favorites}),(function(t){console.log(t)}))},loadData:function(){var i=this;r.default.post(s.default.URL("bbs","topic_detail"),{topic_id:this.topic_id}).then((function(e){t.stopPullDownRefresh(),0==e.code?(i.topic=e.data.topic,i.poster=e.data.poster,i.is_report=e.data.is_report,i.topic.images&&(i.curImage=0),e.data.traffic_ad&&(i.traffic_ad=e.data.traffic_ad),e.data.traffic_chp&&o.createInterstitialAd&&!i.traffic_chp&&(i.traffic_chp=o.createInterstitialAd({adUnitId:e.data.traffic_chp}),i.traffic_chp.onLoad((function(){})),i.traffic_chp.onError((function(t){console.log(t)})),i.traffic_chp.onClose((function(){})),i.traffic_chp.show()),i.loadACode()):a.default.toast(e.message)}),(function(t){console.log(t)}))},contentText:function(){var t=this.topic.content.replace(/(<([^>]+)>)/gi,"");return t.replace(/&nbsp;/gi,"")},clickPoster:function(){this.poster?this.painterImage?t.previewImage({urls:[this.painterImage]}):(t.showLoading({title:"海报生成中……"}),this.isShowPainter=!0,this.base={css:{width:"750rpx",height:"1334rpx"},views:[{type:"image",src:this.poster.background,mode:"aspectFill",css:{position:"absolute",left:"0rpx",top:"0rpx",width:"750rpx",height:"1334rpx"}},{type:"image",src:this.topic.author.avatar,mode:"aspectFill",css:{position:"absolute",left:"30rpx",top:"70rpx",width:"120rpx",height:"120rpx",radius:"60rpx"}},{type:"text",text:this.topic.author.nickname,css:{position:"absolute",left:"165rpx",top:"90rpx",width:"525rpx",color:"#FFFFFF",fontSize:"38rpx",textAlign:"left",lineClamp:1}},{type:"text",text:this.topic.author.sign?this.topic.author.sign:this.poster.title,css:{position:"absolute",left:"165rpx",top:"140rpx",width:"525rpx",color:"#FFFFFF",fontSize:"24rpx",textAlign:"left",lineClamp:1}},{type:"view",css:{position:"absolute",left:"30rpx",top:"240rpx",width:"690rpx",height:"860rpx",background:"#FFFFFF",radius:"20rpx"}},{type:"image",src:this.poster.thumb,mode:"aspectFill",css:{position:"absolute",left:"30rpx",top:"240rpx",width:"690rpx",height:"500rpx",radius:"20rpx"}},{type:"text",text:this.contentText(),css:{position:"absolute",left:"70rpx",top:"790rpx",width:"610rpx",color:"#000000",fontSize:"28rpx",lineHeight:"50rpx",lineClamp:2}},{type:"view",css:{position:"absolute",left:"255rpx",top:"940rpx",width:"240rpx",height:"240rpx",background:"#FFFFFF",radius:"120rpx"}},{type:"image",src:this.acode,mode:"aspectFill",css:{position:"absolute",left:"275rpx",top:"960rpx",width:"200rpx",height:"200rpx",borderRadius:"30%",border:"1rpx solid rgb(255,255,255)"}},{type:"text",text:getApp().globalData.appName,css:{position:"absolute",left:"30rpx",top:"1200rpx",width:"690rpx",color:"#FFFFFF",fontSize:"28rpx",textAlign:"center"}}]}):a.default.error("阅读全文后，可查看")},onPainterSuccess:function(i){this.painterImage=i,t.previewImage({urls:[i]}),t.hideLoading()},loadACode:function(){var t=this;r.default.post(s.default.URL("posts","wxacode"),{post_id:this.topic_id}).then((function(i){t.acode=i.data.acode}),(function(t){console.log(t)}))},videoPlay:function(t){var i=t.currentTarget.id;getApp().globalData.videoId!==i&&getApp().globalData.videoContext&&getApp().globalData.videoContext.stop(),getApp().globalData.videoId=i,getApp().globalData.videoContext=o.createVideoContext(getApp().globalData.videoId,this)}}};i.default=l}).call(this,e("df3c")["default"],e("3223")["default"])},d4e1:function(t,i,e){"use strict";(function(t,i){var o=e("47a9");e("c4fa");o(e("3240"));var n=o(e("18f7"));t.__webpack_require_UNI_MP_PLUGIN__=e,i(n.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])}},[["d4e1","common/runtime","common/vendor"]]]);