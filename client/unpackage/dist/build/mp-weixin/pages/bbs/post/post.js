(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bbs/post/post"],{"28ad":function(e,t,i){"use strict";i.r(t);var n=i("93f9"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=o.a},"43a0":function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("c4fa");n(i("3240"));var o=n(i("ddc2"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(o.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"4bda":function(e,t,i){},"93f9":function(e,t,i){"use strict";(function(e){var n=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(i("7aea")),a=n(i("21c8")),s=n(i("f005")),r=n(i("b2e8")),u={components:{},data:function(){return this.requesting=!1,{type:"image",content:"",score_switch:0,score:"",images:[],video:void 0,video_cover:void 0,forum:void 0,subjects:[],at_switch:0,atlist:[],longitude:"",latitude:"",marker:"",address:""}},onLoad:function(t){o.default.addShareScore(t.source),t.type&&(this.type=t.type),t.fid&&t.fname&&(this.forum={id:t.fid,name:t.fname}),this.preCreate(),e.$on("subjectChange",this.onSubjectChange),e.$on("atlistChange",this.onAtlistChange),e.$on("forumChange",this.onForumChange)},onUnload:function(){e.$off("forumChange",this.onForumChange),e.$off("atlistChange",this.onAtlistChange),e.$off("subjectChange",this.onSubjectChange)},onShareAppMessage:function(){return{title:"发布-"+getApp().globalData.appName,path:o.default.addShareSource("pages/bbs/post/post?n=n")}},onShareTimeline:function(){return{title:"发布-"+getApp().globalData.appName}},methods:{openLink:function(e){o.default.openLink(e)},clickType:function(e){this.type=e},clickAddImage:function(){var t=this;e.chooseImage({count:9-this.images.length,sizeType:["compressed"],success:function(e){for(var i=0;i<e.tempFilePaths.length;i++){var n=e.tempFilePaths[i];r.default.upload(s.default.URL("other","upload2"),n).then((function(e){0==e.code?t.images.push({image:e.data}):a.default.error(e.message)}),(function(e){a.default.error(e)}))}},fail:function(e){e.errMsg&&e.errMsg.indexOf("cancel")<0&&a.default.error(e.errMsg)}})},clickDelImage:function(e){e>=0&&e<this.images.length&&this.images.splice(e,1)},clickAddVideo:function(){var t=this;e.chooseVideo({sourceType:["camera","album"],success:function(e){var i=e.tempFilePath;r.default.upload(s.default.URL("other","uploadv"),i).then((function(i){0==i.code?(t.video=i.data,t.video.width=e.width,t.video.height=e.height,console.log(t.video)):a.default.toast(i.message)}),(function(e){a.default.error(e)}))},fail:function(e){e.errMsg&&e.errMsg.indexOf("cancel")<0&&a.default.error(e.errMsg)}})},clickAddVideoPoster:function(){var t=this;e.chooseImage({count:1,sizeType:["compressed"],success:function(e){var i=e.tempFilePaths[0];r.default.upload(s.default.URL("other","upload2"),i).then((function(e){0==e.code?t.video_cover=e.data:a.default.error(e.message)}),(function(e){a.default.error(e)}))},fail:function(e){e.errMsg&&e.errMsg.indexOf("cancel")<0&&a.default.error(e.errMsg)}})},clickDelVideoPoster:function(){this.video_cover=!1},onSubjectChange:function(e){this.subjects=e},onAtlistChange:function(e){this.atlist=e},onForumChange:function(e){this.forum=e},clickAddress:function(){var t=this,i={success:function(e){t.marker=e.name,t.address=e.address,t.longitude=e.longitude,t.latitude=e.latitude},fail:function(e){console.log(e)}};this.latitude&&(i.latitude=this.latitude),this.longitude&&(i.longitude=this.longitude),e.chooseLocation(i)},clickSubject:function(){o.default.openLink("/pages/bbs/subject/subject?subjects="+this.subjects.join("-0-"))},clickAtList:function(){o.default.openLink("/pages/user/atlist/atlist?atlist="+this.atlist.join(","))},clickCreate:function(){var e=this,t=this.content.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>").replace(/\s/g," "),i={type:this.type,content:o.default.htmlEncode(t),latitude:this.latitude,longitude:this.longitude,marker:this.marker,address:this.address,score:this.score};if(this.forum){if(i.forum_id=this.forum.id,this.atlist.length>0&&(i.at_list=this.atlist.join(",")),"image"==this.type)i.images=JSON.stringify(this.images);else if("video"==this.type){if(!this.video)return void a.default.error("请上传视频");i.video=JSON.stringify(this.video),i.video_cover=JSON.stringify(this.video_cover)}i.subjects=this.subjects.join("-0-"),this.requesting||(this.requesting=!0,r.default.post(s.default.URL("bbs","topic_create"),i).then((function(e){0==e.code?(a.default.toast("审核后，他人可见"),setTimeout((function(){o.default.navigateBack()}),1500)):"require_mobile"==e.code?o.default.openLink("/pages/user/login/login?type=mobile&tip=发帖"):"require_avatar"==e.code?o.default.openLink("/pages/user/verify/verify?tip=发帖"):a.default.error(e.message)}),(function(t){e.requesting=!1,console.log(t)})))}else a.default.error("请选择圈子")},preCreate:function(){var t=this;r.default.post(s.default.URL("bbs","topic_create_pre")).then((function(i){0==i.code?(t.at_switch=i.data.at_switch,t.score_switch=i.data.score_switch):"require_mobile"==i.code?e.redirectTo({url:"/pages/user/login/login?type=mobile&tip=发帖"}):"require_avatar"==i.code?e.redirectTo({url:"/pages/user/verify/verify?tip=发帖"}):(a.default.error(i.message),setTimeout((function(){o.default.navigateBack()}),1500))}),(function(e){console.log(e)}))}}};t.default=u}).call(this,i("df3c")["default"])},af9f:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return n}));var n={uniIcons:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(i.bind(null,"ef62"))}},o=function(){var e=this.$createElement,t=(this._self._c,this.content.length),i="image"==this.type?this.images.length:null,n=this.subjects.length,o=1==this.at_switch?this.atlist.length:null;this.$mp.data=Object.assign({},{$root:{g0:t,g1:i,g2:n,g3:o}})},a=[]},b855:function(e,t,i){"use strict";var n=i("4bda"),o=i.n(n);o.a},ddc2:function(e,t,i){"use strict";i.r(t);var n=i("af9f"),o=i("28ad");for(var a in o)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(a);i("b855");var s=i("828b"),r=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=r.exports}},[["43a0","common/runtime","common/vendor"]]]);