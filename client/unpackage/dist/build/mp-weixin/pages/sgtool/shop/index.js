(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sgtool/shop/index"],{"2ff1":function(e,o,t){"use strict";t.r(o);var n=t("f99e"),r=t("643d");for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(o,e,(function(){return r[e]}))}(a);t("b2b9");var s=t("828b"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"cc16ec6a",null,!1,n["a"],void 0);o["default"]=c.exports},"643d":function(e,o,t){"use strict";t.r(o);var n=t("7b45"),r=t.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){t.d(o,e,(function(){return n[e]}))}(a);o["default"]=r.a},"7b45":function(e,o,t){"use strict";(function(e){var n=t("47a9");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r=n(t("af34")),a=n(t("3b2d")),s=(n(t("008b")),n(t("7aea")),n(t("f005")),{components:{ZhuigeNodata:function(){t.e("components/zhuige-nodata").then(function(){return resolve(t("bb50"))}.bind(null,t)).catch(t.oe)}},data:function(){return{categories:[],subCategories:[],recommendProducts1:[],recommendProducts2:[],recommendTitle1:"热门推荐",recommendTitle2:"新品上市",recommendDesc1:"",recommendDesc2:"",products:[],currentCategory:0,initialCategoryId:0,page:1,isLoading:!1,hasMore:!0,apiBaseUrl:"https://x.erquhealth.com/wp-json/zhuige-xcx/v1"}},onLoad:function(){var e=this;console.log("商品分发频道页面加载"),this.checkNetworkStatus((function(){e.testApi(),e.loadCategories()}))},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadMoreProducts()},onPullDownRefresh:function(){this.refreshData()},methods:{checkApiUrlValidity:function(){return!0},getCategoryPagePath:function(e){return"/pages/sgtool/shop/index?category_id="+e},getSubCategoryPagePath:function(e){return"/pages/sgtool/shop/subcategory?id="+e},checkNetworkStatus:function(o){e.getNetworkType({success:function(t){console.log("当前网络类型:",t.networkType),"none"===t.networkType?(console.error("网络不可用"),e.showToast({title:"网络不可用，请检查网络设置",icon:"none",duration:3e3})):"function"===typeof o&&o()}})},testApi:function(){console.log("开始测试API接口");var o=this.apiBaseUrl+"/sgtool/shop/test";console.log("请求URL:",o),e.request({url:o,method:"GET",success:function(o){console.log("测试API请求成功:",o),200===o.statusCode&&200===o.data.code?console.log("API系统正常工作:",o.data.data):(console.error("测试API请求返回错误:",o.data),e.showToast({title:"测试API返回错误: "+(o.data.msg||"未知错误"),icon:"none",duration:3e3}))},fail:function(o){console.error("测试API请求失败:",o);var t="";t=o.errMsg?o.errMsg:"object"===(0,a.default)(o)?JSON.stringify(o):String(o),e.showToast({title:"网络请求失败: "+t,icon:"none",duration:3e3})}})},loadCategories:function(){var o=this;this.isLoading=!0,console.log("开始加载分类数据");var t=this.apiBaseUrl+"/sgtool/shop/categories";console.log("请求URL:",t),e.request({url:t,method:"GET",header:{"content-type":"application/json"},success:function(t){if(console.log("分类数据请求成功:",t),200===t.statusCode&&200===t.data.code){if(o.categories=t.data.data,console.log("获取到分类数据:",o.categories),o.initialCategoryId&&o.categories.find((function(e){return e.id===o.initialCategoryId})))o.currentCategory=o.initialCategoryId,console.log("使用初始分类ID:",o.currentCategory);else{var n=o.categories.find((function(e){return 1===e.sort_order}));!n&&o.categories.length>0&&(n=o.categories[0]),n&&(o.currentCategory=n.id,console.log("设置当前分类ID:",o.currentCategory))}o.currentCategory?(o.loadSubCategories(),o.loadRecommendProducts(),o.loadProducts()):console.log("没有获取到分类数据")}else console.error("分类数据请求返回错误:",t.data),e.showToast({title:t.data.msg||"加载分类失败",icon:"none"})},fail:function(o){console.error("分类数据请求失败:",o),e.showToast({title:"网络错误: "+JSON.stringify(o),icon:"none"})},complete:function(){o.isLoading=!1,console.log("分类数据请求完成")}})},loadSubCategories:function(){var o=this;console.log("开始加载二级分类数据");var t=this.apiBaseUrl+"/sgtool/shop/subcategories";console.log("请求URL:",t),console.log("请求参数:",{parent_id:this.currentCategory}),e.request({url:t,method:"GET",data:{parent_id:this.currentCategory},success:function(e){console.log("二级分类数据请求成功:",e),200===e.statusCode&&200===e.data.code?(o.subCategories=e.data.data,console.log("获取到二级分类数据:",o.subCategories)):console.error("二级分类数据请求返回错误:",e.data)},fail:function(e){console.error("二级分类数据请求失败:",e)}})},loadRecommendProducts:function(){var o=this;console.log("开始加载推荐商品数据");var t=this.apiBaseUrl+"/sgtool/shop/recommend";console.log("请求URL:",t),console.log("请求参数:",{category_id:this.currentCategory}),e.request({url:t,method:"GET",data:{category_id:this.currentCategory},success:function(e){if(console.log("推荐商品数据请求成功:",e),200===e.statusCode&&200===e.data.code){var t=e.data.data;t.recommend1?(o.recommendProducts1=t.recommend1.products||[],o.recommendTitle1=t.recommend1.title||"热门推荐",o.recommendDesc1=t.recommend1.desc||"",console.log("获取到推荐模块1数据:",o.recommendProducts1)):(o.recommendProducts1=[],o.recommendTitle1="热门推荐",o.recommendDesc1=""),t.recommend2?(o.recommendProducts2=t.recommend2.products||[],o.recommendTitle2=t.recommend2.title||"新品上市",o.recommendDesc2=t.recommend2.desc||"",console.log("获取到推荐模块2数据:",o.recommendProducts2)):(o.recommendProducts2=[],o.recommendTitle2="新品上市",o.recommendDesc2="")}else console.error("推荐商品数据请求返回错误:",e.data)},fail:function(e){console.error("推荐商品数据请求失败:",e)}})},loadProducts:function(){var o=this;this.isLoading=!0,this.page=1,this.products=[],console.log("开始加载商品数据");var t=this.apiBaseUrl+"/sgtool/shop/products";console.log("请求URL:",t),console.log("请求参数:",{category_id:this.currentCategory,page:this.page,per_page:10}),e.request({url:t,method:"GET",data:{category_id:this.currentCategory,page:this.page,per_page:10},success:function(t){console.log("商品数据请求成功:",t),200===t.statusCode&&200===t.data.code?(o.products=t.data.data.list,o.hasMore=t.data.data.more,console.log("获取到商品数据:",o.products)):(console.error("商品数据请求返回错误:",t.data),e.showToast({title:t.data.msg||"加载商品失败",icon:"none"}))},fail:function(o){console.error("商品数据请求失败:",o),e.showToast({title:"网络错误",icon:"none"})},complete:function(){o.isLoading=!1,e.stopPullDownRefresh(),console.log("商品数据请求完成")}})},loadMoreProducts:function(){var o=this;if(this.hasMore&&!this.isLoading){this.isLoading=!0,this.page++;var t=this.apiBaseUrl+"/sgtool/shop/products";e.request({url:t,method:"GET",data:{category_id:this.currentCategory,page:this.page,per_page:10},success:function(t){200===t.statusCode&&200===t.data.code?(o.products=[].concat((0,r.default)(o.products),(0,r.default)(t.data.data.list)),o.hasMore=t.data.data.more):(o.page--,e.showToast({title:t.data.msg||"加载更多失败",icon:"none"}))},fail:function(t){o.page--,e.showToast({title:"网络错误",icon:"none"})},complete:function(){o.isLoading=!1}})}},switchCategory:function(e){this.currentCategory!==e&&(this.currentCategory=e,this.loadSubCategories(),this.loadRecommendProducts(),this.loadProducts())},refreshData:function(){this.loadCategories()},navigateToSubCategory:function(o){e.navigateTo({url:"/pages/sgtool/shop/subcategory?id="+o})},navigateToDetail:function(o){o.app_id&&o.path&&e.navigateToMiniProgram({appId:o.app_id,path:o.path,success:function(){console.log("跳转成功")},fail:function(o){console.error("跳转失败",o),e.showToast({title:"跳转失败",icon:"none"})}})}}});o.default=s}).call(this,t("df3c")["default"])},b2b9:function(e,o,t){"use strict";var n=t("f431"),r=t.n(n);r.a},c51c:function(e,o,t){"use strict";(function(e,o){var n=t("47a9");t("c4fa");n(t("3240"));var r=n(t("2ff1"));e.__webpack_require_UNI_MP_PLUGIN__=t,o(r.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},f431:function(e,o,t){},f99e:function(e,o,t){"use strict";t.d(o,"b",(function(){return n})),t.d(o,"c",(function(){return r})),t.d(o,"a",(function(){}));var n=function(){var e=this,o=e.$createElement,t=(e._self._c,e.subCategories.length),n=e.recommendProducts1.length>0||e.recommendProducts2.length>0,r=n?e.recommendProducts1.length:null,a=n&&r>0?e.__map(e.recommendProducts1.slice(0,2),(function(o,t){var n=e.__get_orig(o),r=o.slides&&o.slides.length>0;return{$orig:n,g3:r}})):null,s=n?e.recommendProducts2.length:null,c=n&&s>0?e.__map(e.recommendProducts2.slice(0,2),(function(o,t){var n=e.__get_orig(o),r=o.slides&&o.slides.length>0;return{$orig:n,g5:r}})):null,i=e.__map(e.products,(function(o,t){var n=e.__get_orig(o),r=o.slides&&o.slides.length>0;return{$orig:n,g6:r}})),d=e.products.length;e._isMounted||(e.e0=function(o,t){var n=arguments[arguments.length-1].currentTarget.dataset,r=n.eventParams||n["event-params"];t=r.product;return e.navigateToDetail(t)},e.e1=function(o,t){var n=arguments[arguments.length-1].currentTarget.dataset,r=n.eventParams||n["event-params"];t=r.product;return e.navigateToDetail(t)}),e.$mp.data=Object.assign({},{$root:{g0:t,g1:n,g2:r,l0:a,g4:s,l1:c,l2:i,g7:d}})},r=[]}},[["c51c","common/runtime","common/vendor"]]]);