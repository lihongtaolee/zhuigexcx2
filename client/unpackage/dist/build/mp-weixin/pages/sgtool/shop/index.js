(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sgtool/shop/index"],{"2ff1":function(o,e,t){"use strict";t.r(e);var n=t("31f1"),r=t("643d");for(var a in r)["default"].indexOf(a)<0&&function(o){t.d(e,o,(function(){return r[o]}))}(a);t("c350");var s=t("828b"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"5d8b68c0",null,!1,n["a"],void 0);e["default"]=c.exports},"31f1":function(o,e,t){"use strict";t.d(e,"b",(function(){return n})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){}));var n=function(){var o=this,e=o.$createElement,t=(o._self._c,o.subCategories.length),n=o.recommendProducts1.length>0||o.recommendProducts2.length>0,r=n?o.recommendProducts1.length:null,a=n&&r>0?o.__map(o.recommendProducts1.slice(0,2),(function(e,t){var n=o.__get_orig(e),r=e.slides&&e.slides.length>0;return{$orig:n,g3:r}})):null,s=n?o.recommendProducts2.length:null,c=n&&s>0?o.__map(o.recommendProducts2.slice(0,2),(function(e,t){var n=o.__get_orig(e),r=e.slides&&e.slides.length>0;return{$orig:n,g5:r}})):null,i=o.__map(o.products,(function(e,t){var n=o.__get_orig(e),r=e.slides&&e.slides.length>0;return{$orig:n,g6:r}})),d=o.products.length;o._isMounted||(o.e0=function(e,t){var n=arguments[arguments.length-1].currentTarget.dataset,r=n.eventParams||n["event-params"];t=r.product;return o.navigateToDetail(t)},o.e1=function(e,t){var n=arguments[arguments.length-1].currentTarget.dataset,r=n.eventParams||n["event-params"];t=r.product;return o.navigateToDetail(t)}),o.$mp.data=Object.assign({},{$root:{g0:t,g1:n,g2:r,l0:a,g4:s,l1:c,l2:i,g7:d}})},r=[]},"44dd":function(o,e,t){},"643d":function(o,e,t){"use strict";t.r(e);var n=t("7b45"),r=t.n(n);for(var a in n)["default"].indexOf(a)<0&&function(o){t.d(e,o,(function(){return n[o]}))}(a);e["default"]=r.a},"7b45":function(o,e,t){"use strict";(function(o){var n=t("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(t("af34")),a=n(t("3b2d")),s=(n(t("008b")),n(t("7aea")),n(t("f005")),{components:{ZhuigeNodata:function(){t.e("components/zhuige-nodata").then(function(){return resolve(t("bb50"))}.bind(null,t)).catch(t.oe)}},data:function(){return{categories:[],subCategories:[],recommendProducts1:[],recommendProducts2:[],recommendTitle1:"热门推荐",recommendTitle2:"新品上市",recommendDesc1:"",recommendDesc2:"",products:[],currentCategory:0,initialCategoryId:0,page:1,isLoading:!1,hasMore:!0,apiBaseUrl:"https://x.erquhealth.com/wp-json/zhuige-xcx/v1"}},onLoad:function(){var o=this;console.log("商品分发频道页面加载"),this.checkNetworkStatus((function(){o.testApi(),o.loadCategories()}))},onReachBottom:function(){this.hasMore&&!this.isLoading&&this.loadMoreProducts()},onPullDownRefresh:function(){this.refreshData()},methods:{checkApiUrlValidity:function(){return!0},getCategoryPagePath:function(o){return"/pages/sgtool/shop/index?category_id="+o},getSubCategoryPagePath:function(o){return"/pages/sgtool/shop/subcategory?id="+o},checkNetworkStatus:function(e){o.getNetworkType({success:function(t){console.log("当前网络类型:",t.networkType),"none"===t.networkType?(console.error("网络不可用"),o.showToast({title:"网络不可用，请检查网络设置",icon:"none",duration:3e3})):"function"===typeof e&&e()}})},testApi:function(){console.log("开始测试API接口");var e=this.apiBaseUrl+"/sgtool/shop/test";console.log("请求URL:",e),o.request({url:e,method:"GET",success:function(e){console.log("测试API请求成功:",e),200===e.statusCode&&200===e.data.code?console.log("API系统正常工作:",e.data.data):(console.error("测试API请求返回错误:",e.data),o.showToast({title:"测试API返回错误: "+(e.data.msg||"未知错误"),icon:"none",duration:3e3}))},fail:function(e){console.error("测试API请求失败:",e);var t="";t=e.errMsg?e.errMsg:"object"===(0,a.default)(e)?JSON.stringify(e):String(e),o.showToast({title:"网络请求失败: "+t,icon:"none",duration:3e3})}})},loadCategories:function(){var e=this;this.isLoading=!0,console.log("开始加载分类数据");var t=this.apiBaseUrl+"/sgtool/shop/categories";console.log("请求URL:",t),o.request({url:t,method:"GET",header:{"content-type":"application/json"},success:function(t){if(console.log("分类数据请求成功:",t),200===t.statusCode&&200===t.data.code){if(e.categories=t.data.data,console.log("获取到分类数据:",e.categories),e.initialCategoryId&&e.categories.find((function(o){return o.id===e.initialCategoryId})))e.currentCategory=e.initialCategoryId,console.log("使用初始分类ID:",e.currentCategory);else{var n=e.categories.find((function(o){return 1===o.sort_order}));!n&&e.categories.length>0&&(n=e.categories[0]),n&&(e.currentCategory=n.id,console.log("设置当前分类ID:",e.currentCategory))}e.currentCategory?(e.loadSubCategories(),e.loadRecommendProducts(),e.loadProducts()):console.log("没有获取到分类数据")}else console.error("分类数据请求返回错误:",t.data),o.showToast({title:t.data.msg||"加载分类失败",icon:"none"})},fail:function(e){console.error("分类数据请求失败:",e),o.showToast({title:"网络错误: "+JSON.stringify(e),icon:"none"})},complete:function(){e.isLoading=!1,console.log("分类数据请求完成")}})},loadSubCategories:function(){var e=this;console.log("开始加载二级分类数据");var t=this.apiBaseUrl+"/sgtool/shop/subcategories";console.log("请求URL:",t),console.log("请求参数:",{parent_id:this.currentCategory}),o.request({url:t,method:"GET",data:{parent_id:this.currentCategory},success:function(o){console.log("二级分类数据请求成功:",o),200===o.statusCode&&200===o.data.code?(e.subCategories=o.data.data,console.log("获取到二级分类数据:",e.subCategories)):console.error("二级分类数据请求返回错误:",o.data)},fail:function(o){console.error("二级分类数据请求失败:",o)}})},loadRecommendProducts:function(){var e=this;console.log("开始加载推荐商品数据");var t=this.apiBaseUrl+"/sgtool/shop/recommend";console.log("请求URL:",t),console.log("请求参数:",{category_id:this.currentCategory}),o.request({url:t,method:"GET",data:{category_id:this.currentCategory},success:function(o){if(console.log("推荐商品数据请求成功:",o),200===o.statusCode&&200===o.data.code){var t=o.data.data;t.recommend1?(e.recommendProducts1=t.recommend1.products||[],e.recommendTitle1=t.recommend1.title||"热门推荐",e.recommendDesc1=t.recommend1.desc||"",console.log("获取到推荐模块1数据:",e.recommendProducts1)):(e.recommendProducts1=[],e.recommendTitle1="热门推荐",e.recommendDesc1=""),t.recommend2?(e.recommendProducts2=t.recommend2.products||[],e.recommendTitle2=t.recommend2.title||"新品上市",e.recommendDesc2=t.recommend2.desc||"",console.log("获取到推荐模块2数据:",e.recommendProducts2)):(e.recommendProducts2=[],e.recommendTitle2="新品上市",e.recommendDesc2="")}else console.error("推荐商品数据请求返回错误:",o.data)},fail:function(o){console.error("推荐商品数据请求失败:",o)}})},loadProducts:function(){var e=this;this.isLoading=!0,this.page=1,this.products=[],console.log("开始加载商品数据");var t=this.apiBaseUrl+"/sgtool/shop/products";console.log("请求URL:",t),console.log("请求参数:",{category_id:this.currentCategory,page:this.page,per_page:10}),o.request({url:t,method:"GET",data:{category_id:this.currentCategory,page:this.page,per_page:10},success:function(t){console.log("商品数据请求成功:",t),200===t.statusCode&&200===t.data.code?(e.products=t.data.data.list,e.hasMore=t.data.data.more,console.log("获取到商品数据:",e.products)):(console.error("商品数据请求返回错误:",t.data),o.showToast({title:t.data.msg||"加载商品失败",icon:"none"}))},fail:function(e){console.error("商品数据请求失败:",e),o.showToast({title:"网络错误",icon:"none"})},complete:function(){e.isLoading=!1,o.stopPullDownRefresh(),console.log("商品数据请求完成")}})},loadMoreProducts:function(){var e=this;if(this.hasMore&&!this.isLoading){this.isLoading=!0,this.page++;var t=this.apiBaseUrl+"/sgtool/shop/products";o.request({url:t,method:"GET",data:{category_id:this.currentCategory,page:this.page,per_page:10},success:function(t){200===t.statusCode&&200===t.data.code?(e.products=[].concat((0,r.default)(e.products),(0,r.default)(t.data.data.list)),e.hasMore=t.data.data.more):(e.page--,o.showToast({title:t.data.msg||"加载更多失败",icon:"none"}))},fail:function(t){e.page--,o.showToast({title:"网络错误",icon:"none"})},complete:function(){e.isLoading=!1}})}},switchCategory:function(o){this.currentCategory!==o&&(this.currentCategory=o,this.loadSubCategories(),this.loadRecommendProducts(),this.loadProducts())},refreshData:function(){this.loadCategories()},navigateToSubCategory:function(e){o.navigateTo({url:"/pages/sgtool/shop/subcategory?id="+e})},navigateToDetail:function(e){e.app_id&&e.path&&o.navigateToMiniProgram({appId:e.app_id,path:e.path,success:function(){console.log("跳转成功")},fail:function(e){console.error("跳转失败",e),o.showToast({title:"跳转失败",icon:"none"})}})}}});e.default=s}).call(this,t("df3c")["default"])},c350:function(o,e,t){"use strict";var n=t("44dd"),r=t.n(n);r.a},c51c:function(o,e,t){"use strict";(function(o,e){var n=t("47a9");t("c4fa");n(t("3240"));var r=n(t("2ff1"));o.__webpack_require_UNI_MP_PLUGIN__=t,e(r.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])}},[["c51c","common/runtime","common/vendor"]]]);