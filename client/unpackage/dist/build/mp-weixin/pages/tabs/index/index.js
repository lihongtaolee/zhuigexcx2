(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabs/index/index"],{3750:function(e,t,a){"use strict";var o=a("bd9b"),i=a.n(o);i.a},9081:function(e,t,a){"use strict";a.r(t);var o=a("9943"),i=a.n(o);for(var n in o)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(n);t["default"]=i.a},9943:function(e,t,a){"use strict";(function(e){var o=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(a("7eb4")),n=o(a("ee10")),s=o(a("7aea")),c=o(a("f005")),l=o(a("b2e8")),u={components:{ZhuigeIcons:function(){a.e("components/zhuige-icons").then(function(){return resolve(a("2b26"))}.bind(null,a)).catch(a.oe)},zhuigeHeightPredict:function(){a.e("components/zhuige-height-predict").then(function(){return resolve(a("cae9"))}.bind(null,a)).catch(a.oe)},ZhuigeSgztmkModule:function(){a.e("components/zhuige-sgztmk-module").then(function(){return resolve(a("1b54"))}.bind(null,a)).catch(a.oe)}},data:function(){return{isLoading:!0,logo:void 0,style:"",icons:[],heightData:this.getDefaultHeightData(),apiBaseUrl:"https://x.erquhealth.com/wp-json/zhuige/sgtool",sgztmkModules:[],isModulesLoading:!0,logoCacheKey:"zhuige_xcx_logo_cache",logoCacheTime:"zhuige_xcx_logo_cache_time",moduleStatus:{icons:"loading",sgztmk:"loading"},iconsCacheKey:"zhuige_xcx_icons_cache",iconsCacheTime:"zhuige_xcx_icons_cache_time"}},onLoad:function(){this.loadCachedData(),this.refresh(),this.fetchUserHeightData()},onShow:function(){this.loadCachedData(),this.refresh();var t=e.getStorageSync("zhuige_xcx_user");t&&t.user_id?this.fetchUserHeightData():this.heightData=this.getDefaultHeightData()},methods:{openLink:function(e){s.default.openLink(e)},refresh:function(){this.loadSetting()},loadCachedData:function(){var t=getApp();if(t.globalData.homePageCache?(this.logo=t.globalData.homePageCache.logo,t.globalData.homePageCache.icons&&t.globalData.homePageCache.icons.length>0?(this.icons=t.globalData.homePageCache.icons,this.moduleStatus.icons="show"):this.loadCachedIcons(),t.globalData.homePageCache.style&&(this.style=t.globalData.homePageCache.style),this.isLoading=!1):(this.loadCachedLogo(),this.loadCachedIcons()),t.globalData.sgztmkModulesCache)this.sgztmkModules=t.globalData.sgztmkModulesCache,this.moduleStatus.sgztmk=this.sgztmkModules.length>0?"show":"hide",this.isModulesLoading=!1;else try{var a=e.getStorageSync("zhuige_sgztmk_modules_cache"),o=e.getStorageSync("zhuige_sgztmk_modules_cache_time"),i=(new Date).getTime();a&&o&&i-o<864e5&&(this.sgztmkModules=JSON.parse(a),this.moduleStatus.sgztmk=this.sgztmkModules.length>0?"show":"hide",this.isModulesLoading=!1)}catch(n){console.error("读取身高专题模块缓存失败",n)}},loadCachedLogo:function(){var t=e.getStorageSync(this.logoCacheKey),a=e.getStorageSync(this.logoCacheTime),o=(new Date).getTime();t&&a&&o-a<864e5&&(this.logo=t,this.isLoading=!1)},loadCachedIcons:function(){var t=e.getStorageSync(this.iconsCacheKey),a=e.getStorageSync(this.iconsCacheTime),o=(new Date).getTime();if(t&&a&&o-a<864e5)try{var i=JSON.parse(t);Array.isArray(i)&&i.length>0?(this.icons=i,this.moduleStatus.icons="show"):this.moduleStatus.icons="hide"}catch(n){console.error("解析金刚位缓存数据失败",n),this.moduleStatus.icons="loading"}},loadSetting:function(){var t=this;l.default.post(c.default.URL("setting","home")).then((function(a){t.logo=a.data.logo;var o=a.data.icons||[],i=JSON.stringify(t.icons),n=JSON.stringify(o);i!==n&&(0!==t.icons.length&&i===n||(t.icons=o)),t.moduleStatus.icons=o.length>0?"show":"hide",a.data.style&&(t.style=a.data.style),e.setStorageSync(t.logoCacheKey,a.data.logo),e.setStorageSync(t.logoCacheTime,(new Date).getTime()),e.setStorageSync(t.iconsCacheKey,JSON.stringify(o)),e.setStorageSync(t.iconsCacheTime,(new Date).getTime());var s=getApp();s.globalData.homePageCache&&(s.globalData.homePageCache.logo=a.data.logo,s.globalData.homePageCache.icons=a.data.icons,s.globalData.homePageCache.style=a.data.style,s.globalData.homePageCache.timestamp=(new Date).getTime()),t.fetchSgztmkModules(),t.isLoading=!1})).catch((function(e){t.isLoading=!1}))},getDefaultHeightData:function(){return{currentHeight:165,geneticHeight:175,targetHeight:180,probability:85,baobaoname:"演示宝宝",updateTime:""}},fetchUserHeightData:function(){var t=this;return(0,n.default)(i.default.mark((function a(){var o,n,s;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=e.getStorageSync("zhuige_xcx_user"),o&&o.user_id){a.next=5;break}return t.heightData=t.getDefaultHeightData(),t.isLoading=!1,a.abrupt("return");case 5:return a.prev=5,a.next=8,e.request({url:"".concat(t.apiBaseUrl,"/get_user_height_data"),method:"GET",data:{user_id:o.user_id},header:{"content-type":"application/json"}});case 8:n=a.sent,200===n.statusCode&&n.data&&0===n.data.code&&(s=n.data.data,s&&s.baobaoname&&s.current_height&&s.target_height&&s.prediction_probability?t.heightData={geneticHeight:Number(1===s.gender?s.boy_genetic_height:s.girl_genetic_height),currentHeight:Number(s.current_height),targetHeight:Number(s.target_height),probability:Number(s.prediction_probability),baobaoname:s.baobaoname,updateTime:s.create_time}:t.heightData=t.getDefaultHeightData()),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](5),e.showToast({title:"获取数据失败",icon:"none"}),t.heightData=t.getDefaultHeightData();case 16:return a.prev=16,t.isLoading=!1,a.finish(16);case 19:case"end":return a.stop()}}),a,null,[[5,12,16,19]])})))()},fetchSgztmkModules:function(){var t=this;return(0,n.default)(i.default.mark((function a(){var o,s,u,r;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,l.default.post(c.default.URL("sgtool","get_sgztmk_modules"));case 3:if(o=a.sent,!o.data||!Array.isArray(o.data.modules)){a.next=15;break}return s=e.getStorageSync("zhuige_xcx_user"),a.next=8,Promise.all(o.data.modules.map(function(){var t=(0,n.default)(i.default.mark((function t(a){var o,n,c,l,u,r,g,h;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a.left_module.value_api){t.next=14;break}if(o="60",!s||!s.user_id){t.next=13;break}return t.prev=3,n=a.left_module.value_api.replace("{user_id}",s.user_id),t.next=7,e.request({url:n,method:"GET",header:{"content-type":"application/json"}});case 7:c=t.sent,c.data&&200===c.data.code&&c.data.data&&(l=c.data.data,Array.isArray(l)&&l.length>0&&(u=l[l.length-1],r=n.split("?")[1],g=r.match(/fields=([^&]*)/),h=g?g[1]:null,h&&void 0!==u[h]&&(o=Number(u[h]).toFixed(1)))),t.next=13;break;case 11:t.prev=11,t.t0=t["catch"](3);case 13:a.left_module.value=o;case 14:return t.abrupt("return",a);case 15:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e){return t.apply(this,arguments)}}()));case 8:if(u=a.sent,JSON.stringify(t.sgztmkModules)!==JSON.stringify(u)&&(t.sgztmkModules=u),t.moduleStatus.sgztmk=u.length>0?"show":"hide",r=getApp(),r.globalData){r.globalData.sgztmkModulesCache=t.sgztmkModules;try{e.setStorageSync("zhuige_sgztmk_modules_cache",JSON.stringify(t.sgztmkModules)),e.setStorageSync("zhuige_sgztmk_modules_cache_time",(new Date).getTime())}catch(g){console.error("缓存身高专题模块数据失败",g)}}a.next=17;break;case 15:t.sgztmkModules=[],t.moduleStatus.sgztmk="hide";case 17:a.next=23;break;case 19:a.prev=19,a.t0=a["catch"](0),t.sgztmkModules=[],t.moduleStatus.sgztmk="hide";case 23:return a.prev=23,t.isModulesLoading=!1,a.finish(23);case 26:case"end":return a.stop()}}),a,null,[[0,19,23,26]])})))()}}};t.default=u}).call(this,a("df3c")["default"])},b77b:function(e,t,a){"use strict";a.r(t);var o=a("cef4"),i=a("9081");for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);a("3750");var s=a("828b"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=c.exports},bd9b:function(e,t,a){},cef4:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return o}));var o={uniNavBar:function(){return a.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(a.bind(null,"74ca"))},uniIcons:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(a.bind(null,"ef62"))}},i=function(){var e=this,t=e.$createElement,a=(e._self._c,"show"===e.moduleStatus.icons&&e.icons&&e.icons.length>0),o="show"===e.moduleStatus.sgztmk&&e.sgztmkModules&&e.sgztmkModules.length>0,i=o?e.__map(e.sgztmkModules,(function(t,a){var o=e.__get_orig(t),i={title:t.left_module.title,icon:t.icon,description:t.left_module.description,image:t.left_module.image,buttonText:t.left_module.button_text,link:t.left_module.link,value:t.left_module.value,bgColor:t.left_module.bg_color},n={title:t.right_top_module.title,description:t.right_top_module.description,image:t.right_top_module.image,buttonText:t.right_top_module.button_text,link:t.right_top_module.link,bgColor:t.right_top_module.bg_color},s={title:t.right_bottom_module.title,description:t.right_bottom_module.description,image:t.right_bottom_module.image,buttonText:t.right_bottom_module.button_text,link:t.right_bottom_module.link,bgColor:t.right_bottom_module.bg_color};return{$orig:o,a0:i,a1:n,a2:s}})):null;e.$mp.data=Object.assign({},{$root:{g0:a,g1:o,l0:i}})},n=[]},ec72:function(e,t,a){"use strict";(function(e,t){var o=a("47a9");a("c4fa");o(a("3240"));var i=o(a("b77b"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(i.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])}},[["ec72","common/runtime","common/vendor"]]]);